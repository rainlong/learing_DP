# 组合模式 Composite
## 背景
点组成线，线组成面，面组成体......这些都是形状，希望能用一致的接口来使用它们以及它们的组合体。

## 定义
>将对象组合成**<sup>[1]</sup>树形结构**以表示**“部分-整体”**的层次结构。使得用户对单个对象和组合对象的使用具有**一致性**。

## 难点 & 关键
1. 树形结构
  + 节点抽象element: 包含**公共接口operation**，以及**可以重载的方法add、remove和返回自身(容器)的getChild**；
  
  + 叶子节点elementLeaf: 只实现公共接口operation；
  
  + 组合节点composite: 持有一个容器，存放组合的材料，除了实现公共接口operation，还要实现add/remove/getChild.
  
2. 一致性
  
  element保证了接口的一致性，但**add/remove**这两个方法需要讨论一下：
  
  + 在leaf中也实现add/remove，是没有意义的，但保持了接口的一致性，这叫**透明方式**；
  
  + 在leaf中不实现add/remove，合乎需求，但接口不再一致，这叫**安全方式**；
  
  + 这里用虚函数，让leaf继承了add/remove，是透明方式。

> 要素
> + 统一的基类，叶子和组合实现相同的接口，用C++时注意不要全用纯虚函数。
> + 组合类中要维护一个容器，要实现“添加/移除”功能。
> + 要提供返回自身(容器)的接口getChild。

## 优点
+ 可以清楚地定义分层次的复杂对象，并统一地使用它的整体或部分，表示和增删都很方便，也很容易创建复杂对象。

+ 客户的使用更方便，接口少。

+ 添加新的构建也很方便，**对修改封闭，对扩展开放**。

## 不足
+ 使设计更加抽象，对象的业务规则如果很复杂，则在设计统一的接口时难度加大。==> 要注意**所有的方法是否都能和leaf对象关联在一起**。

## 适用环境
适合应用于公用场合的对象：
+ 表示一个对象整体或部分层次，在具有整体和部分的层级结构中，希望通过一种方式忽略整体和部分的差异，希望用一致的接口来对待它们。
+ 让客户能**忽略不同对象层次的变化**，客户端可以针对抽象构建编程，而**无需关心对象层级结构的细节**。
