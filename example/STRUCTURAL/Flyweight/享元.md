# 享元模式 Flyweight
## 背景
如：对几段话套用不同的格式；
又如：描述围棋对决，黑棋和白棋频繁出现，不同的时出现的位置。对于这些**大量细粒度**的对象（文字，黑白棋子），频繁创建对象会消耗大量资源。

## 定义
>运用**<sup>[1]</sup>共享技术**有效地支持大量**<sup>[2]</sup>细粒度**的对象。

## 难点 & 关键
1. 共享技术
     + 定义**内部状态**和**外部状态**，内部状态是细粒度对象的内部属性，是重复的部分；外部状态是变化的部分，需要**实现对外的接口**以支持对这部分的修改，**外部状态由客户端来考虑**。
 
     + 在实现**可共享享元类**时，要传递内部状态，因为是依靠内部状态的不同来区分不同对象。

2. 细粒度对象

     对象有**许多外部状态**，而除去外部状态之后只有较少的不同表示，可以作为共享对象来取代多组对象。

3. **必须有一个工厂对象加以维护。**
  + 因为类型基本一致，所以可以使用一个统一的工厂来创建对象，维护一个容器，在创建时**通过内部状态来区分对象**。

> 要素
> + 基类不是抽象类(纯虚类)
> + 私有的内部状态intrinsicState
> + 构造函数需要输入内部状态
> + 公有的对外接口operation,用于外部状态的变化
> + 获取内部状态的接口getIntrinsicState
> + **必须有一个工厂对象加以维护。**
> + 用**“工厂”**实现对象的创建，工厂中维护一个对象容器，保持**内部状态不同的对象集合**。

## 优点
+ 减少细粒度对象的创建，提高效率；减少内存的占用。

## 不足
+ 需要维护一个系统已有享元的容器(工厂类中的容器)。
+ 为了使对象可以共享，需要将一些状态**外部化**，使得程序的逻辑复杂。  ==> 只有在对象足够多且可以分享时才值得使用。

## 适用环境
+ 大量对象造成**很大的存储开销**时；
+ 对象有**许多外部状态**，而除去外部状态之后可以**用较少的共享对象来取代多组对象**时；

可以实现**对象池**



